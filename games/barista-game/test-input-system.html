<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입력 시스템 테스트 - 바리스타 게임</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
        .input-test-area {
            border: 2px dashed #007acc;
            padding: 50px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .input-test-area.active {
            background: #e3f2fd;
            border-color: #1976d2;
        }
        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007acc;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎮 바리스타 게임 - 입력 시스템 테스트</h1>
        
        <div class="test-section">
            <h3>1. 입력 테스트 영역</h3>
            <p>아래 영역에서 마우스 클릭, 터치, 키보드 입력을 테스트하세요.</p>
            <div class="input-test-area" id="inputTestArea">
                <h4>🎯 입력 테스트 영역</h4>
                <p>마우스 클릭, 터치, 또는 스페이스바/엔터키를 눌러보세요</p>
                <p><small>홀드하고 있으면 영역이 파란색으로 변경됩니다</small></p>
            </div>
            <div id="inputResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. 입력 통계</h3>
            <button class="test-button" onclick="updateInputStats()">통계 업데이트</button>
            <button class="test-button" onclick="clearInputStats()">통계 초기화</button>
            <div class="stats-display" id="statsDisplay">
                <div class="stat-card">
                    <div class="stat-value" id="totalInputs">0</div>
                    <div class="stat-label">총 입력</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="mouseInputs">0</div>
                    <div class="stat-label">마우스 입력</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="touchInputs">0</div>
                    <div class="stat-label">터치 입력</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgResponseTime">0ms</div>
                    <div class="stat-label">평균 응답시간</div>
                </div>
            </div>
            <div id="statsResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. 모바일 최적화 테스트</h3>
            <button class="test-button" onclick="testMobileOptimizations()">모바일 최적화 확인</button>
            <button class="test-button" onclick="testOrientationChange()">방향 변경 테스트</button>
            <div id="mobileResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. 타이밍 정확도 테스트</h3>
            <button class="test-button" onclick="testTimingAccuracy()">타이밍 정확도 테스트</button>
            <button class="test-button" onclick="testResponseTime()">응답 시간 테스트</button>
            <div id="timingResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. 이벤트 중복 방지 테스트</h3>
            <button class="test-button" onclick="testEventPrevention()">이벤트 중복 방지 테스트</button>
            <div id="eventResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>6. 전체 테스트 실행</h3>
            <button class="test-button" onclick="runAllInputTests()">전체 테스트 실행</button>
            <div id="allResult" class="test-result"></div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        let testArea;
        let inputStatsInterval;
        
        // 테스트 영역 설정
        document.addEventListener('DOMContentLoaded', () => {
            testArea = document.getElementById('inputTestArea');
            
            // 테스트 영역에 이벤트 리스너 추가
            testArea.addEventListener('mousedown', handleTestInput);
            testArea.addEventListener('mouseup', handleTestInput);
            testArea.addEventListener('touchstart', handleTestInput);
            testArea.addEventListener('touchend', handleTestInput);
            
            // 주기적으로 통계 업데이트
            inputStatsInterval = setInterval(updateInputStats, 1000);
        });
        
        function handleTestInput(event) {
            const result = document.getElementById('inputResult');
            const eventType = event.type;
            const timestamp = new Date().toLocaleTimeString();
            
            let message = `[${timestamp}] ${eventType} 이벤트 감지\n`;
            
            if (event.type.includes('start') || event.type.includes('down')) {
                testArea.classList.add('active');
                message += '홀드 시작\n';
            } else {
                testArea.classList.remove('active');
                message += '홀드 종료\n';
            }
            
            if (event.touches) {
                message += `터치 개수: ${event.touches.length}\n`;
            }
            
            result.textContent = message + '\n' + result.textContent;
            result.className = 'test-result info';
            
            // 자동 스크롤
            result.scrollTop = 0;
        }
        
        function updateInputStats() {
            try {
                const stats = window.getInputStats();
                
                document.getElementById('totalInputs').textContent = stats.totalInputs;
                document.getElementById('mouseInputs').textContent = `${stats.mouseInputs} (${stats.mousePercentage}%)`;
                document.getElementById('touchInputs').textContent = `${stats.touchInputs} (${stats.touchPercentage}%)`;
                document.getElementById('avgResponseTime').textContent = `${stats.averageResponseTime.toFixed(2)}ms`;
                
                const result = document.getElementById('statsResult');
                let output = '입력 통계:\n\n';
                output += `총 입력: ${stats.totalInputs}\n`;
                output += `마우스: ${stats.mouseInputs} (${stats.mousePercentage}%)\n`;
                output += `터치: ${stats.touchInputs} (${stats.touchPercentage}%)\n`;
                output += `평균 응답 시간: ${stats.averageResponseTime.toFixed(2)}ms\n`;
                output += `마지막 응답 시간: ${stats.lastResponseTime.toFixed(2)}ms\n`;
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                const result = document.getElementById('statsResult');
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function clearInputStats() {
            window.baristaGame.inputManager.reset();
            updateInputStats();
            
            const result = document.getElementById('statsResult');
            result.textContent = '입력 통계가 초기화되었습니다.';
            result.className = 'test-result info';
        }
        
        function testMobileOptimizations() {
            const result = document.getElementById('mobileResult');
            let output = '모바일 최적화 테스트:\n\n';
            
            try {
                // 뷰포트 메타 태그 확인
                const viewport = document.querySelector('meta[name="viewport"]');
                output += `뷰포트 메타 태그: ${viewport ? '✅ 존재' : '❌ 없음'}\n`;
                
                // 터치 액션 확인
                const touchAction = window.getComputedStyle(testArea).touchAction;
                output += `터치 액션: ${touchAction}\n`;
                
                // 사용자 에이전트 확인
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                output += `모바일 디바이스: ${isMobile ? '✅ 감지됨' : '❌ 데스크톱'}\n`;
                
                // 터치 지원 확인
                const touchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                output += `터치 지원: ${touchSupport ? '✅ 지원됨' : '❌ 지원 안됨'}\n`;
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testOrientationChange() {
            const result = document.getElementById('mobileResult');
            let output = result.textContent + '\n\n방향 변경 테스트:\n';
            
            // 현재 방향
            const orientation = screen.orientation ? screen.orientation.angle : 'unknown';
            output += `현재 방향: ${orientation}도\n`;
            
            // 방향 변경 이벤트 리스너 테스트
            const hasOrientationListener = window.baristaGame.inputManager.handleOrientationChange;
            output += `방향 변경 핸들러: ${hasOrientationListener ? '✅ 존재' : '❌ 없음'}\n`;
            
            result.textContent = output;
            result.className = 'test-result info';
        }
        
        function testTimingAccuracy() {
            const result = document.getElementById('timingResult');
            let output = '타이밍 정확도 테스트:\n\n';
            
            try {
                // performance.now() 정확도 테스트
                const start = performance.now();
                setTimeout(() => {
                    const end = performance.now();
                    const measured = end - start;
                    const expected = 100; // 100ms
                    const accuracy = Math.abs(measured - expected);
                    
                    output += `예상: ${expected}ms\n`;
                    output += `측정: ${measured.toFixed(2)}ms\n`;
                    output += `오차: ${accuracy.toFixed(2)}ms\n`;
                    output += `정확도: ${accuracy < 10 ? '✅ 우수' : accuracy < 50 ? '⚠️ 보통' : '❌ 나쁨'}\n`;
                    
                    result.textContent = output;
                    result.className = accuracy < 10 ? 'test-result success' : 'test-result warning';
                }, 100);
                
                result.textContent = output + '측정 중...';
                result.className = 'test-result info';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testResponseTime() {
            const result = document.getElementById('timingResult');
            let output = result.textContent + '\n\n응답 시간 테스트:\n';
            
            try {
                const stats = window.getInputStats();
                
                if (stats.totalInputs > 0) {
                    output += `평균 응답 시간: ${stats.averageResponseTime.toFixed(2)}ms\n`;
                    output += `마지막 응답 시간: ${stats.lastResponseTime.toFixed(2)}ms\n`;
                    
                    let performance = '❌ 나쁨';
                    if (stats.averageResponseTime < 16) performance = '✅ 우수';
                    else if (stats.averageResponseTime < 33) performance = '⚠️ 보통';
                    
                    output += `성능 평가: ${performance}\n`;
                    
                    result.textContent = output;
                    result.className = stats.averageResponseTime < 16 ? 'test-result success' : 'test-result warning';
                } else {
                    output += '입력 데이터가 없습니다. 먼저 입력을 테스트해주세요.\n';
                    result.textContent = output;
                    result.className = 'test-result info';
                }
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testEventPrevention() {
            const result = document.getElementById('eventResult');
            let output = '이벤트 중복 방지 테스트:\n\n';
            
            try {
                // 빠른 연속 클릭 테스트
                let clickCount = 0;
                const startTime = Date.now();
                
                const testHandler = () => {
                    clickCount++;
                    if (clickCount >= 5) {
                        const endTime = Date.now();
                        const duration = endTime - startTime;
                        
                        output += `5회 클릭 시간: ${duration}ms\n`;
                        output += `평균 간격: ${(duration / 4).toFixed(2)}ms\n`;
                        
                        if (duration < 500) {
                            output += `결과: ⚠️ 너무 빠름 (중복 방지 필요)\n`;
                            result.className = 'test-result warning';
                        } else {
                            output += `결과: ✅ 적절한 간격\n`;
                            result.className = 'test-result success';
                        }
                        
                        result.textContent = output;
                        testArea.removeEventListener('click', testHandler);
                    }
                };
                
                testArea.addEventListener('click', testHandler);
                output += '빠르게 5회 클릭해주세요...\n';
                result.textContent = output;
                result.className = 'test-result info';
                
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function runAllInputTests() {
            const result = document.getElementById('allResult');
            result.textContent = '전체 테스트 실행 중...\n\n';
            result.className = 'test-result info';
            
            setTimeout(() => {
                try {
                    testMobileOptimizations();
                    testTimingAccuracy();
                    updateInputStats();
                    
                    result.textContent = '✅ 모든 테스트 완료!\n\n각 섹션의 결과를 확인하세요.';
                    result.className = 'test-result success';
                } catch (error) {
                    result.textContent = `❌ 테스트 실행 중 에러: ${error.message}`;
                    result.className = 'test-result error';
                }
            }, 100);
        }
        
        // 페이지 언로드 시 정리
        window.addEventListener('beforeunload', () => {
            if (inputStatsInterval) {
                clearInterval(inputStatsInterval);
            }
        });
    </script>
</body>
</html>
