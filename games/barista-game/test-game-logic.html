<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì„ ë¡œì§ í…ŒìŠ¤íŠ¸ - ë°”ë¦¬ìŠ¤íƒ€ ê²Œì„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007acc;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        .logic-test-area {
            border: 2px dashed #007acc;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 300px;
            position: relative;
        }
        .score-display {
            font-size: 2em;
            font-weight: bold;
            color: #007acc;
            margin: 10px 0;
        }
        .combo-display {
            font-size: 1.5em;
            color: #ff6b6b;
            margin: 5px 0;
        }
        .time-display {
            font-size: 1.2em;
            color: #4ecdc4;
            margin: 5px 0;
        }
        .lives-display {
            font-size: 1.2em;
            color: #ff6b6b;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¯ ë°”ë¦¬ìŠ¤íƒ€ ê²Œì„ - ê²Œì„ ë¡œì§ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>1. ê²Œì„ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜</h3>
            <div class="logic-test-area">
                <h4>ê²Œì„ ìƒíƒœ í‘œì‹œ</h4>
                <div class="score-display" id="currentScore">ì ìˆ˜: 0</div>
                <div class="combo-display" id="currentCombo">ì½¤ë³´: 0</div>
                <div class="time-display" id="currentTime">ì‹œê°„: 120ì´ˆ</div>
                <div class="lives-display" id="currentLives">ìƒëª…: 3</div>
                
                <div style="margin-top: 20px;">
                    <button class="test-button" onclick="simulatePerfect()">ì™„ë²½í•œ íƒ€ì´ë° ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="test-button" onclick="simulateSuccess()">ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="test-button" onclick="simulateTooEarly()">ë„ˆë¬´ ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="test-button" onclick="simulateOverflow()">ë„˜ì¹¨ ì‹œë®¬ë ˆì´ì…˜</button>
                </div>
            </div>
            <div id="simulationResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. ì ìˆ˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testScoreCalculation()">ì ìˆ˜ ê³„ì‚° í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testComboSystem()">ì½¤ë³´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testTimeSystem()">ì‹œê°„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <div id="scoreResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. ê²Œì„ í†µê³„ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testGameStats()">ê²Œì„ í†µê³„ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testFinalStats()">ìµœì¢… í†µê³„ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testGameOverConditions()">ê²Œì„ ì˜¤ë²„ ì¡°ê±´ í…ŒìŠ¤íŠ¸</button>
            <div id="statsResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. ê²Œì„ ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testGameBalance()">ê²Œì„ ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testInfinitePlay()">ë¬´í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</button>
            <button class="test-button" onclick="testDifficultyProgression()">ë‚œì´ë„ ì§„í–‰ í…ŒìŠ¤íŠ¸</button>
            <div id="balanceResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. ì‹¤ì‹œê°„ í†µê³„</h3>
            <button class="test-button" onclick="updateGameStats()">í†µê³„ ì—…ë°ì´íŠ¸</button>
            <button class="test-button" onclick="clearGameStats()">í†µê³„ ì´ˆê¸°í™”</button>
            <div class="stats-display" id="gameStatsDisplay">
                <div class="stat-card">
                    <div class="stat-value" id="totalCups">0</div>
                    <div class="stat-label">ì´ ì»µ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="perfectCups">0</div>
                    <div class="stat-label">ì™„ë²½í•œ ì»µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successCups">0</div>
                    <div class="stat-label">ì„±ê³µí•œ ì»µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedCups">0</div>
                    <div class="stat-label">ì‹¤íŒ¨í•œ ì»µ</div>
                </div>
            </div>
            <div id="liveStatsResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>6. ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h3>
            <button class="test-button" onclick="runAllLogicTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="allResult" class="test-result"></div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        let game;
        let statsInterval;
        
        // í…ŒìŠ¤íŠ¸ìš© ê²Œì„ ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            game = window.baristaGame;
            
            // ì£¼ê¸°ì ìœ¼ë¡œ í†µê³„ ì—…ë°ì´íŠ¸
            statsInterval = setInterval(updateGameStats, 1000);
            
            // ì´ˆê¸° ìƒíƒœ í™•ì¸
            updateGameStats();
        });
        
        function simulatePerfect() {
            const result = document.getElementById('simulationResult');
            result.textContent = 'ì™„ë²½í•œ íƒ€ì´ë° ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...\n\n';
            result.className = 'test-result info';
            
            try {
                // ì™„ë²½í•œ íƒ€ì´ë° ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                game.processPerfect();
                updateDisplay();
                
                result.textContent += 'ì™„ë²½í•œ íƒ€ì´ë° ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!\n';
                result.textContent += `ì ìˆ˜: +${20 + (game.combo - 1) * 10}ì , ì½¤ë³´: ${game.combo}, ì‹œê°„: +2ì´ˆ`;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function simulateSuccess() {
            const result = document.getElementById('simulationResult');
            result.textContent = 'ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...\n\n';
            result.className = 'test-result info';
            
            try {
                game.processSuccess();
                updateDisplay();
                
                result.textContent += 'ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!\n';
                result.textContent += `ì ìˆ˜: +10ì , ì½¤ë³´: ${game.combo}, ì‹œê°„: +2ì´ˆ`;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function simulateTooEarly() {
            const result = document.getElementById('simulationResult');
            result.textContent = 'ë„ˆë¬´ ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...\n\n';
            result.className = 'test-result info';
            
            try {
                game.processTooEarly();
                updateDisplay();
                
                result.textContent += 'ë„ˆë¬´ ë¹ ë¥¸ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!\n';
                result.textContent += `ì ìˆ˜: ë³€í™”ì—†ìŒ, ì½¤ë³´: ë¦¬ì…‹, ì‹œê°„: -10ì´ˆ`;
                result.className = 'test-result warning';
            } catch (error) {
                result.textContent = `ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function simulateOverflow() {
            const result = document.getElementById('simulationResult');
            result.textContent = 'ë„˜ì¹¨ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...\n\n';
            result.className = 'test-result info';
            
            try {
                game.processOverflow();
                updateDisplay();
                
                result.textContent += 'ë„˜ì¹¨ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!\n';
                result.textContent += `ì ìˆ˜: ë³€í™”ì—†ìŒ, ì½¤ë³´: ë¦¬ì…‹, ìƒëª…: -1, ì‹œê°„: -10ì´ˆ`;
                result.className = 'test-result error';
            } catch (error) {
                result.textContent = `ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function updateDisplay() {
            document.getElementById('currentScore').textContent = `ì ìˆ˜: ${game.score.toLocaleString()}`;
            document.getElementById('currentCombo').textContent = `ì½¤ë³´: ${game.combo}`;
            document.getElementById('currentTime').textContent = `ì‹œê°„: ${game.gameTime.toFixed(1)}ì´ˆ`;
            document.getElementById('currentLives').textContent = `ìƒëª…: ${game.lives}`;
        }
        
        function testScoreCalculation() {
            const result = document.getElementById('scoreResult');
            result.textContent = 'ì ìˆ˜ ê³„ì‚° í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ì´ˆê¸° ìƒíƒœ ì €ì¥
                const initialScore = game.score;
                const initialCombo = game.combo;
                
                // ì„±ê³µ í…ŒìŠ¤íŠ¸
                game.processSuccess();
                const successScore = game.score - initialScore;
                
                // ì™„ë²½í•œ íƒ€ì´ë° í…ŒìŠ¤íŠ¸
                const perfectScoreBefore = game.score;
                game.processPerfect();
                const perfectScore = game.score - perfectScoreBefore;
                
                result.textContent += `âœ… ì„±ê³µ ì ìˆ˜: +${successScore}ì  (ì˜ˆìƒ: 10ì )\n`;
                result.textContent += `âœ… ì™„ë²½í•œ íƒ€ì´ë° ì ìˆ˜: +${perfectScore}ì  (ì˜ˆìƒ: 20+ì½¤ë³´ë³´ë„ˆìŠ¤)\n`;
                result.textContent += `âœ… ì½¤ë³´ ì‹œìŠ¤í…œ: ${game.combo} (ì˜ˆìƒ: 2)\n`;
                
                result.textContent += '\nì ìˆ˜ ê³„ì‚° í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ì ìˆ˜ ê³„ì‚° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testComboSystem() {
            const result = document.getElementById('scoreResult');
            result.textContent = 'ì½¤ë³´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ì´ˆê¸° ì½¤ë³´
                const initialCombo = game.combo;
                
                // ì—°ì† ì„±ê³µìœ¼ë¡œ ì½¤ë³´ ì¦ê°€ í…ŒìŠ¤íŠ¸
                for (let i = 0; i < 3; i++) {
                    game.processSuccess();
                }
                
                result.textContent += `âœ… ì„±ê³µ í›„ ì½¤ë³´: ${game.combo} (ì˜ˆìƒ: ${initialCombo + 3})\n`;
                
                // ì™„ë²½í•œ íƒ€ì´ë°ìœ¼ë¡œ ì½¤ë³´ ë³´ë„ˆìŠ¤ í…ŒìŠ¤íŠ¸
                const scoreBefore = game.score;
                game.processPerfect();
                const scoreAfter = game.score;
                const comboBonus = scoreAfter - scoreBefore - 20; // ê¸°ë³¸ 20ì  ì œì™¸
                
                result.textContent += `âœ… ì™„ë²½í•œ íƒ€ì´ë° ì½¤ë³´ ë³´ë„ˆìŠ¤: +${comboBonus}ì  (ì˜ˆìƒ: ${game.combo * 10})\n`;
                
                // ì‹¤íŒ¨ë¡œ ì½¤ë³´ ë¦¬ì…‹ í…ŒìŠ¤íŠ¸
                game.processTooEarly();
                
                result.textContent += `âœ… ì‹¤íŒ¨ í›„ ì½¤ë³´ ë¦¬ì…‹: ${game.combo} (ì˜ˆìƒ: 0)\n`;
                
                result.textContent += '\nì½¤ë³´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ì½¤ë³´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testTimeSystem() {
            const result = document.getElementById('scoreResult');
            result.textContent = 'ì‹œê°„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ì´ˆê¸° ì‹œê°„
                const initialTime = game.gameTime;
                
                // ì„±ê³µìœ¼ë¡œ ì‹œê°„ ì—°ì¥ í…ŒìŠ¤íŠ¸
                game.processSuccess();
                const timeAfterSuccess = game.gameTime;
                
                // ì™„ë²½í•œ íƒ€ì´ë°ìœ¼ë¡œ ì‹œê°„ ì—°ì¥ í…ŒìŠ¤íŠ¸
                game.processPerfect();
                const timeAfterPerfect = game.gameTime;
                
                // ì‹¤íŒ¨ë¡œ ì‹œê°„ ê°ì†Œ í…ŒìŠ¤íŠ¸
                game.processTooEarly();
                const timeAfterFailure = game.gameTime;
                
                result.textContent += `âœ… ì´ˆê¸° ì‹œê°„: ${initialTime.toFixed(1)}ì´ˆ\n`;
                result.textContent += `âœ… ì„±ê³µ í›„ ì‹œê°„: ${timeAfterSuccess.toFixed(1)}ì´ˆ (+2ì´ˆ)\n`;
                result.textContent += `âœ… ì™„ë²½ í›„ ì‹œê°„: ${timeAfterPerfect.toFixed(1)}ì´ˆ (+2ì´ˆ)\n`;
                result.textContent += `âœ… ì‹¤íŒ¨ í›„ ì‹œê°„: ${timeAfterFailure.toFixed(1)}ì´ˆ (-10ì´ˆ)\n`;
                
                result.textContent += '\nì‹œê°„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ì‹œê°„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testGameStats() {
            const result = document.getElementById('statsResult');
            result.textContent = 'ê²Œì„ í†µê³„ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                const stats = game.gameStats;
                
                result.textContent += `âœ… ì´ ì»µ ìˆ˜: ${stats.totalCups}\n`;
                result.textContent += `âœ… ì™„ë²½í•œ ì»µ: ${stats.perfectCups}\n`;
                result.textContent += `âœ… ì„±ê³µí•œ ì»µ: ${stats.successCups}\n`;
                result.textContent += `âœ… ì‹¤íŒ¨í•œ ì»µ: ${stats.failedCups}\n`;
                result.textContent += `âœ… ì´ í”Œë ˆì´ ì‹œê°„: ${(stats.totalPlayTime / 1000).toFixed(1)}ì´ˆ\n`;
                
                const accuracy = stats.totalCups > 0 
                    ? ((stats.successCups + stats.perfectCups) / stats.totalCups * 100).toFixed(1)
                    : 0;
                
                result.textContent += `âœ… ì •í™•ë„: ${accuracy}%\n`;
                
                result.textContent += '\nê²Œì„ í†µê³„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ê²Œì„ í†µê³„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testFinalStats() {
            const result = document.getElementById('statsResult');
            result.textContent = 'ìµœì¢… í†µê³„ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                const finalStats = game.calculateFinalStats();
                
                result.textContent += `âœ… ìµœì¢… ì ìˆ˜: ${finalStats.finalScore.toLocaleString()}\n`;
                result.textContent += `âœ… ìµœê³  ì ìˆ˜: ${finalStats.highScore.toLocaleString()}\n`;
                result.textContent += `âœ… ìµœëŒ€ ì½¤ë³´: ${finalStats.maxCombo}\n`;
                result.textContent += `âœ… ì •í™•ë„: ${finalStats.accuracy.toFixed(1)}%\n`;
                result.textContent += `âœ… ì™„ë²½ë¥ : ${finalStats.perfectRate.toFixed(1)}%\n`;
                result.textContent += `âœ… ì»µë‹¹ í‰ê·  ì ìˆ˜: ${finalStats.avgScorePerCup.toFixed(1)}\n`;
                result.textContent += `âœ… ê²Œì„ ì˜¤ë²„ ì‚¬ìœ : ${finalStats.gameOverReason || 'ì§„í–‰ ì¤‘'}\n`;
                
                result.textContent += '\nìµœì¢… í†µê³„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ìµœì¢… í†µê³„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testGameOverConditions() {
            const result = document.getElementById('statsResult');
            result.textContent = 'ê²Œì„ ì˜¤ë²„ ì¡°ê±´ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ì´ˆê¸° ìƒíƒœ
                const initialLives = game.lives;
                const initialTime = game.gameTime;
                
                result.textContent += `âœ… ì´ˆê¸° ìƒëª…: ${initialLives}\n`;
                result.textContent += `âœ… ì´ˆê¸° ì‹œê°„: ${initialTime.toFixed(1)}ì´ˆ\n`;
                
                // ìƒëª… ì†Œì§„ í…ŒìŠ¤íŠ¸
                game.lives = 0;
                result.textContent += `âœ… ìƒëª… ì†Œì§„ ì‹œ ê²Œì„ ì˜¤ë²„: ${game.isGameOver() ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}\n`;
                result.textContent += `âœ… ê²Œì„ ì˜¤ë²„ ì‚¬ìœ : ${game.getGameOverReason()}\n`;
                
                // ì‹œê°„ ì†Œì§„ í…ŒìŠ¤íŠ¸
                game.lives = 3;
                game.gameTime = 0;
                result.textContent += `âœ… ì‹œê°„ ì†Œì§„ ì‹œ ê²Œì„ ì˜¤ë²„: ${game.isGameOver() ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}\n`;
                result.textContent += `âœ… ê²Œì„ ì˜¤ë²„ ì‚¬ìœ : ${game.getGameOverReason()}\n`;
                
                // ì •ìƒ ìƒíƒœ ë³µì›
                game.lives = initialLives;
                game.gameTime = initialTime;
                
                result.textContent += '\nê²Œì„ ì˜¤ë²„ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ê²Œì„ ì˜¤ë²„ ì¡°ê±´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testGameBalance() {
            const result = document.getElementById('balanceResult');
            result.textContent = 'ê²Œì„ ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ì™„ë²½í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ (ì‹œê°„ ë¬´í•œ ì—°ì¥)
                let perfectCount = 0;
                let timeIncrease = 0;
                
                for (let i = 0; i < 10; i++) {
                    const timeBefore = game.gameTime;
                    game.processPerfect();
                    const timeAfter = game.gameTime;
                    timeIncrease += (timeAfter - timeBefore);
                    perfectCount++;
                }
                
                result.textContent += `âœ… ${perfectCount}ë²ˆ ì™„ë²½í•œ í”Œë ˆì´ í›„ ì‹œê°„ ì¦ê°€: +${timeIncrease.toFixed(1)}ì´ˆ\n`;
                result.textContent += `âœ… ì™„ë²½í•œ í”Œë ˆì´ë¡œ ë¬´í•œ ê²Œì„ ê°€ëŠ¥: ${timeIncrease > 0 ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}\n`;
                
                // ì‹¤íŒ¨ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜
                const timeBeforeFailure = game.gameTime;
                game.processOverflow();
                const timeAfterFailure = game.gameTime;
                const timeDecrease = timeBeforeFailure - timeAfterFailure;
                
                result.textContent += `âœ… ë„˜ì¹¨ ì‹¤íŒ¨ í›„ ì‹œê°„ ê°ì†Œ: -${timeDecrease.toFixed(1)}ì´ˆ\n`;
                result.textContent += `âœ… ìƒëª… ê°ì†Œ: ${game.lives}\n`;
                
                result.textContent += '\nê²Œì„ ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ê²Œì„ ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testInfinitePlay() {
            const result = document.getElementById('balanceResult');
            result.textContent = 'ë¬´í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜:\n\n';
            result.className = 'test-result info';
            
            try {
                let simulationCount = 0;
                let maxTimeReached = game.gameTime;
                
                // ì™„ë²½í•œ í”Œë ˆì´ë¡œ ì‹œê°„ ì—°ì¥ ì‹œë®¬ë ˆì´ì…˜
                while (simulationCount < 50 && game.gameTime < 300) { // ìµœëŒ€ 5ë¶„ê¹Œì§€
                    game.processPerfect();
                    maxTimeReached = Math.max(maxTimeReached, game.gameTime);
                    simulationCount++;
                }
                
                result.textContent += `âœ… ${simulationCount}ë²ˆ ì™„ë²½í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜\n`;
                result.textContent += `âœ… ìµœëŒ€ ë„ë‹¬ ì‹œê°„: ${maxTimeReached.toFixed(1)}ì´ˆ\n`;
                result.textContent += `âœ… ë¬´í•œ í”Œë ˆì´ ê°€ëŠ¥ì„±: ${maxTimeReached > 200 ? 'ë†’ìŒ' : 'ë³´í†µ'}\n`;
                
                result.textContent += '\në¬´í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ë¬´í•œ í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testDifficultyProgression() {
            const result = document.getElementById('balanceResult');
            result.textContent = 'ë‚œì´ë„ ì§„í–‰ í…ŒìŠ¤íŠ¸:\n\n';
            result.className = 'test-result info';
            
            try {
                // ë‹¤ì–‘í•œ ê²°ê³¼ íŒ¨í„´ í…ŒìŠ¤íŠ¸
                const patterns = [
                    { name: 'ì™„ë²½í•œ í”Œë ˆì´', results: ['perfect', 'perfect', 'perfect'] },
                    { name: 'í˜¼í•© í”Œë ˆì´', results: ['perfect', 'success', 'tooEarly'] },
                    { name: 'ì‹¤íŒ¨ í”Œë ˆì´', results: ['overflow', 'tooEarly', 'overflow'] }
                ];
                
                for (const pattern of patterns) {
                    const initialScore = game.score;
                    const initialTime = game.gameTime;
                    const initialLives = game.lives;
                    
                    for (const resultType of pattern.results) {
                        switch (resultType) {
                            case 'perfect':
                                game.processPerfect();
                                break;
                            case 'success':
                                game.processSuccess();
                                break;
                            case 'tooEarly':
                                game.processTooEarly();
                                break;
                            case 'overflow':
                                game.processOverflow();
                                break;
                        }
                    }
                    
                    const scoreChange = game.score - initialScore;
                    const timeChange = game.gameTime - initialTime;
                    const livesChange = game.lives - initialLives;
                    
                    result.textContent += `âœ… ${pattern.name}: ì ìˆ˜ ${scoreChange > 0 ? '+' : ''}${scoreChange}, ì‹œê°„ ${timeChange > 0 ? '+' : ''}${timeChange.toFixed(1)}ì´ˆ, ìƒëª… ${livesChange > 0 ? '+' : ''}${livesChange}\n`;
                }
                
                result.textContent += '\në‚œì´ë„ ì§„í–‰ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `ë‚œì´ë„ ì§„í–‰ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function updateGameStats() {
            try {
                const stats = game.gameStats;
                
                document.getElementById('totalCups').textContent = stats.totalCups;
                document.getElementById('perfectCups').textContent = stats.perfectCups;
                document.getElementById('successCups').textContent = stats.successCups;
                document.getElementById('failedCups').textContent = stats.failedCups;
                
                const result = document.getElementById('liveStatsResult');
                let output = 'ì‹¤ì‹œê°„ ê²Œì„ í†µê³„:\n\n';
                output += `í˜„ì¬ ì ìˆ˜: ${game.score.toLocaleString()}\n`;
                output += `í˜„ì¬ ì½¤ë³´: ${game.combo}\n`;
                output += `ìµœëŒ€ ì½¤ë³´: ${game.maxCombo}\n`;
                output += `ìƒëª…: ${game.lives}\n`;
                output += `ê²Œì„ ì‹œê°„: ${game.gameTime.toFixed(1)}ì´ˆ\n`;
                output += `ì´ ì»µ ìˆ˜: ${stats.totalCups}\n`;
                output += `ì™„ë²½í•œ ì»µ: ${stats.perfectCups}\n`;
                output += `ì„±ê³µí•œ ì»µ: ${stats.successCups}\n`;
                output += `ì‹¤íŒ¨í•œ ì»µ: ${stats.failedCups}\n`;
                
                if (stats.totalCups > 0) {
                    const accuracy = ((stats.successCups + stats.perfectCups) / stats.totalCups * 100).toFixed(1);
                    const perfectRate = (stats.perfectCups / stats.totalCups * 100).toFixed(1);
                    output += `ì •í™•ë„: ${accuracy}%\n`;
                    output += `ì™„ë²½ë¥ : ${perfectRate}%\n`;
                }
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                const result = document.getElementById('liveStatsResult');
                result.textContent = `ì—ëŸ¬: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function clearGameStats() {
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™” (í…ŒìŠ¤íŠ¸ìš©)
            game.score = 0;
            game.combo = 0;
            game.maxCombo = 0;
            game.lives = 3;
            game.gameTime = 120;
            game.gameStats = {
                totalCups: 0,
                perfectCups: 0,
                successCups: 0,
                failedCups: 0,
                totalPlayTime: 0,
                startTime: Date.now()
            };
            
            updateDisplay();
            updateGameStats();
            
            const result = document.getElementById('liveStatsResult');
            result.textContent = 'ê²Œì„ í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.';
            result.className = 'test-result info';
        }
        
        function runAllLogicTests() {
            const result = document.getElementById('allResult');
            result.textContent = 'ì „ì²´ ê²Œì„ ë¡œì§ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...\n\n';
            result.className = 'test-result info';
            
            setTimeout(() => {
                try {
                    testScoreCalculation();
                    setTimeout(() => testComboSystem(), 1000);
                    setTimeout(() => testTimeSystem(), 2000);
                    setTimeout(() => testGameStats(), 3000);
                    setTimeout(() => testFinalStats(), 4000);
                    setTimeout(() => testGameOverConditions(), 5000);
                    setTimeout(() => testGameBalance(), 6000);
                    
                    result.textContent = 'âœ… ëª¨ë“  ê²Œì„ ë¡œì§ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\nê° í…ŒìŠ¤íŠ¸ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.';
                    result.className = 'test-result success';
                } catch (error) {
                    result.textContent = `âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì—ëŸ¬: ${error.message}`;
                    result.className = 'test-result error';
                }
            }, 100);
        }
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (statsInterval) {
                clearInterval(statsInterval);
            }
        });
    </script>
</body>
</html>
