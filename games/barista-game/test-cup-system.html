<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>컵 시스템 테스트 - 바리스타 게임</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>☕ 바리스타 게임 - 컵 시스템 테스트</h1>
        
        <div class="test-section">
            <h3>1. 기본 컵 타입 테스트</h3>
            <button class="test-button" onclick="testBasicCupTypes()">기본 컵 타입 확인</button>
            <div id="basicResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. 랜덤 컵 생성 테스트</h3>
            <button class="test-button" onclick="testRandomCupGeneration()">랜덤 컵 생성</button>
            <button class="test-button" onclick="testCupGenerationStats()">생성 통계 확인</button>
            <div id="randomResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>3. 새 컵 타입 추가 테스트</h3>
            <button class="test-button" onclick="testAddNewCupType()">새 컵 타입 추가</button>
            <button class="test-button" onclick="testInvalidCupType()">잘못된 컵 타입 테스트</button>
            <div id="addResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. 타이밍 계산 테스트</h3>
            <button class="test-button" onclick="testTimingCalculations()">타이밍 계산 테스트</button>
            <div id="timingResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. 점수 계산 테스트</h3>
            <button class="test-button" onclick="testScoreCalculations()">점수 계산 테스트</button>
            <div id="scoreResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>6. 모든 테스트 실행</h3>
            <button class="test-button" onclick="runAllTests()">전체 테스트 실행</button>
            <div id="allResult" class="test-result"></div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        // 테스트 함수들
        function testBasicCupTypes() {
            const result = document.getElementById('basicResult');
            try {
                const cupTypes = window.baristaGame.cupSystem.getAllCupTypes();
                let output = '기본 컵 타입들:\n\n';
                
                for (const [id, config] of Object.entries(cupTypes)) {
                    output += `${id}: ${config.name}\n`;
                    output += `  - 타이밍: ${config.timing[0]}s ~ ${config.timing[1]}s\n`;
                    output += `  - 완벽: ${config.perfect[0]}s ~ ${config.perfect[1]}s\n`;
                    output += `  - 난이도: ${config.difficulty}\n`;
                    output += `  - 점수: 성공 ${config.points.success}, 완벽 ${config.points.perfect}\n\n`;
                }
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testRandomCupGeneration() {
            const result = document.getElementById('randomResult');
            try {
                const cup = window.baristaGame.cupSystem.generateRandomCup();
                let output = '랜덤 컵 생성 테스트:\n\n';
                output += `컵 ID: ${cup.id}\n`;
                output += `타입: ${cup.type}\n`;
                output += `이름: ${cup.config.name}\n`;
                output += `타이밍: ${cup.config.timing[0]}s ~ ${cup.config.timing[1]}s\n`;
                output += `완벽: ${cup.config.perfect[0]}s ~ ${cup.config.perfect[1]}s\n`;
                output += `난이도: ${cup.config.difficulty}\n`;
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testCupGenerationStats() {
            const result = document.getElementById('randomResult');
            try {
                const stats = window.baristaGame.cupSystem.getGenerationStats();
                let output = result.textContent + '\n\n생성 통계:\n';
                output += `총 생성된 컵: ${stats.total}\n`;
                output += `마지막 타입: ${stats.lastType}\n\n`;
                
                for (const [type, typeStats] of Object.entries(stats.typeStats)) {
                    output += `${type}: ${typeStats.count}개 (${typeStats.percentage}%)\n`;
                }
                
                result.textContent = output;
                result.className = 'test-result info';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testAddNewCupType() {
            const result = document.getElementById('addResult');
            try {
                // 유효한 새 컵 타입 추가
                window.baristaGame.cupSystem.addNewCupType('D', [4.0, 5.0], [4.9, 5.0], {
                    name: 'Mega Cup',
                    difficulty: 'hard',
                    points: { success: 25, perfect: 50 }
                });
                
                let output = '새 컵 타입 추가 테스트:\n\n';
                output += '✅ D 타입 컵 추가 성공\n';
                
                // 모든 컵 타입 확인
                const allTypes = window.baristaGame.cupSystem.getAllCupTypes();
                output += `\n현재 컵 타입 개수: ${Object.keys(allTypes).length}\n`;
                output += `컵 타입들: ${Object.keys(allTypes).join(', ')}\n`;
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testInvalidCupType() {
            const result = document.getElementById('addResult');
            try {
                // 잘못된 타이밍으로 컵 타입 추가 시도
                window.baristaGame.cupSystem.addNewCupType('INVALID', [5.0, 3.0], [4.0, 6.0]);
                result.textContent = result.textContent + '\n❌ 잘못된 컵 타입이 추가됨 (예상치 못한 결과)';
                result.className = 'test-result error';
            } catch (error) {
                result.textContent = result.textContent + `\n✅ 예상된 에러: ${error.message}`;
                result.className = 'test-result success';
            }
        }
        
        function testTimingCalculations() {
            const result = document.getElementById('timingResult');
            try {
                const cup = window.baristaGame.cupSystem.generateRandomCup();
                let output = '타이밍 계산 테스트:\n\n';
                output += `테스트 컵: ${cup.config.name}\n`;
                output += `타이밍 구간: ${cup.config.timing[0]}s ~ ${cup.config.timing[1]}s\n`;
                output += `완벽 구간: ${cup.config.perfect[0]}s ~ ${cup.config.perfect[1]}s\n\n`;
                
                // 다양한 홀드 시간으로 테스트
                const testTimes = [0.5, 1.0, 2.0, 2.3, 2.45, 2.5, 3.0];
                output += '홀드 시간별 결과:\n';
                
                for (const time of testTimes) {
                    const resultType = window.baristaGame.cupSystem.calculateResult(cup, time);
                    output += `${time}s → ${resultType}\n`;
                }
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testScoreCalculations() {
            const result = document.getElementById('scoreResult');
            try {
                const cup = window.baristaGame.cupSystem.generateRandomCup();
                let output = '점수 계산 테스트:\n\n';
                output += `테스트 컵: ${cup.config.name}\n`;
                output += `기본 점수: 성공 ${cup.config.points.success}, 완벽 ${cup.config.points.perfect}\n\n`;
                
                // 다양한 콤보로 테스트
                const testCombos = [0, 1, 2, 5, 10];
                output += '콤보별 점수 계산:\n';
                
                for (const combo of testCombos) {
                    const successScore = window.baristaGame.cupSystem.calculateScore(cup, 'success', combo);
                    const perfectScore = window.baristaGame.cupSystem.calculateScore(cup, 'perfect', combo);
                    output += `콤보 ${combo}: 성공 ${successScore}, 완벽 ${perfectScore}\n`;
                }
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                result.textContent = `에러: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function runAllTests() {
            const result = document.getElementById('allResult');
            result.textContent = '전체 테스트 실행 중...\n\n';
            result.className = 'test-result info';
            
            setTimeout(() => {
                try {
                    testBasicCupTypes();
                    testRandomCupGeneration();
                    testCupGenerationStats();
                    testAddNewCupType();
                    testTimingCalculations();
                    testScoreCalculations();
                    
                    result.textContent = '✅ 모든 테스트 완료!\n\n각 섹션의 결과를 확인하세요.';
                    result.className = 'test-result success';
                } catch (error) {
                    result.textContent = `❌ 테스트 실행 중 에러: ${error.message}`;
                    result.className = 'test-result error';
                }
            }, 100);
        }
    </script>
</body>
</html>
