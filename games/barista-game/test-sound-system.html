<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ - ë°”ë¦¬ìŠ¤íƒ€ ê²Œì„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .test-result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007acc;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        .volume-controls {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            align-items: center;
        }
        .volume-slider {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .volume-slider label {
            font-size: 0.9em;
            color: #666;
        }
        .volume-slider input {
            width: 150px;
        }
        .sound-test-area {
            border: 2px dashed #007acc;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 10px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .sound-test-area.active {
            background: #e3f2fd;
            border-color: #1976d2;
        }
        .frequency-display {
            font-size: 2em;
            font-weight: bold;
            color: #007acc;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”Š ë°”ë¦¬ìŠ¤íƒ€ ê²Œì„ - ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>1. ì‚¬ìš´ë“œ ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <button class="test-button" onclick="checkAudioContext()">ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™•ì¸</button>
            <button class="test-button" onclick="initializeAudio()">ì˜¤ë””ì˜¤ ì´ˆê¸°í™”</button>
            <div id="audioStatus" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>2. ë³¼ë¥¨ ì»¨íŠ¸ë¡¤</h3>
            <div class="volume-controls">
                <div class="volume-slider">
                    <label>ë§ˆìŠ¤í„° ë³¼ë¥¨</label>
                    <input type="range" id="masterVolume" min="0" max="1" step="0.1" value="0.7" onchange="updateVolume('master', this.value)">
                    <span id="masterVolumeValue">0.7</span>
                </div>
                <div class="volume-slider">
                    <label>í™€ë“œ ì‚¬ìš´ë“œ</label>
                    <input type="range" id="holdVolume" min="0" max="1" step="0.1" value="0.6" onchange="updateVolume('hold', this.value)">
                    <span id="holdVolumeValue">0.6</span>
                </div>
                <div class="volume-slider">
                    <label>ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ</label>
                    <input type="range" id="releaseVolume" min="0" max="1" step="0.1" value="0.8" onchange="updateVolume('release', this.value)">
                    <span id="releaseVolumeValue">0.8</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>3. í™€ë“œ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸</h3>
            <div class="sound-test-area" id="holdTestArea">
                <h4>ğŸµ í™€ë“œ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸</h4>
                <p>ë§ˆìš°ìŠ¤ë¥¼ ëˆ„ë¥´ê³  ìˆìœ¼ë©´ í™€ë“œ ì‚¬ìš´ë“œê°€ ì¬ìƒë©ë‹ˆë‹¤</p>
                <div class="frequency-display" id="holdFrequency">-</div>
                <button class="test-button" onmousedown="startHoldTest()" onmouseup="stopHoldTest()" ontouchstart="startHoldTest()" ontouchend="stopHoldTest()">í™€ë“œ í…ŒìŠ¤íŠ¸</button>
            </div>
            <div id="holdResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>4. íƒ€ì´ë°ë³„ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testBasicSound()">ê¸°ë³¸ í™€ë“œ</button>
            <button class="test-button" onclick="testPassingSound()">í•©ê²© êµ¬ê°„</button>
            <button class="test-button" onclick="testPerfectSound()">ì™„ë²½í•œ íƒ€ì´ë°</button>
            <button class="test-button" onclick="testOverflowSound()">ë„˜ì¹¨ ì‚¬ìš´ë“œ</button>
            <div id="timingResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>5. ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testReleaseEarly()">ë¹ ë¥¸ ë¦´ë¦¬ì¦ˆ</button>
            <button class="test-button" onclick="testReleaseSuccess()">ì„±ê³µ ë¦´ë¦¬ì¦ˆ</button>
            <button class="test-button" onclick="testReleasePerfect()">ì™„ë²½í•œ ë¦´ë¦¬ì¦ˆ</button>
            <button class="test-button" onclick="testReleaseOverflow()">ë„˜ì¹¨ ë¦´ë¦¬ì¦ˆ</button>
            <div id="releaseResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>6. í´ë°± ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testFallbackSounds()">í´ë°± ì‚¬ìš´ë“œ ìƒì„±</button>
            <button class="test-button" onclick="testFrequencyRange()">ì£¼íŒŒìˆ˜ ë²”ìœ„ í…ŒìŠ¤íŠ¸</button>
            <div id="fallbackResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>7. ì‚¬ìš´ë“œ í†µê³„</h3>
            <button class="test-button" onclick="updateSoundStats()">í†µê³„ ì—…ë°ì´íŠ¸</button>
            <button class="test-button" onclick="clearSoundStats()">í†µê³„ ì´ˆê¸°í™”</button>
            <div class="stats-display" id="soundStatsDisplay">
                <div class="stat-card">
                    <div class="stat-value" id="soundsLoaded">0</div>
                    <div class="stat-label">ë¡œë”©ëœ ì‚¬ìš´ë“œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="soundsPlayed">0</div>
                    <div class="stat-label">ì´ ì¬ìƒ íšŸìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="holdSoundsPlayed">0</div>
                    <div class="stat-label">í™€ë“œ ì‚¬ìš´ë“œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="releaseSoundsPlayed">0</div>
                    <div class="stat-label">ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ</div>
                </div>
            </div>
            <div id="statsResult" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h3>8. ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h3>
            <button class="test-button" onclick="runAllSoundTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="allResult" class="test-result"></div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        let soundManager;
        let statsInterval;
        let holdTestInterval;
        
        // í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš´ë“œ ë§¤ë‹ˆì € ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            soundManager = window.baristaGame.soundManager;
            
            // ì£¼ê¸°ì ìœ¼ë¡œ í†µê³„ ì—…ë°ì´íŠ¸
            statsInterval = setInterval(updateSoundStats, 1000);
            
            // ì´ˆê¸° ìƒíƒœ í™•ì¸
            checkAudioContext();
        });
        
        function checkAudioContext() {
            const result = document.getElementById('audioStatus');
            let output = 'ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ìƒíƒœ:\n\n';
            
            try {
                const stats = soundManager.getSoundStats();
                output += `ì´ˆê¸°í™” ìƒíƒœ: ${stats.isInitialized ? 'âœ… ì™„ë£Œ' : 'âŒ ì‹¤íŒ¨'}\n`;
                output += `ë¡œë”©ëœ ì‚¬ìš´ë“œ: ${stats.soundsLoaded}/8\n`;
                output += `ë§ˆìŠ¤í„° ë³¼ë¥¨: ${stats.masterVolume}\n`;
                output += `í™€ë“œ ë³¼ë¥¨: ${stats.volumeSettings.hold}\n`;
                output += `ë¦´ë¦¬ì¦ˆ ë³¼ë¥¨: ${stats.volumeSettings.release}\n`;
                
                if (soundManager.audioContext) {
                    output += `ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ìƒíƒœ: ${soundManager.audioContext.state}\n`;
                    output += `ìƒ˜í”Œ ë ˆì´íŠ¸: ${soundManager.audioContext.sampleRate}Hz\n`;
                }
                
                result.textContent = output;
                result.className = stats.isInitialized ? 'test-result success' : 'test-result warning';
            } catch (error) {
                result.textContent = `ì—ëŸ¬: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        async function initializeAudio() {
            const result = document.getElementById('audioStatus');
            result.textContent = 'ì˜¤ë””ì˜¤ ì´ˆê¸°í™” ì¤‘...';
            result.className = 'test-result info';
            
            try {
                await soundManager.initializeAudioContext();
                await soundManager.loadSounds();
                
                result.textContent = 'ì˜¤ë””ì˜¤ ì´ˆê¸°í™” ì™„ë£Œ!';
                result.className = 'test-result success';
                
                setTimeout(checkAudioContext, 100);
            } catch (error) {
                result.textContent = `ì˜¤ë””ì˜¤ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function updateVolume(category, volume) {
            const volumeValue = parseFloat(volume);
            soundManager.setVolume(category, volumeValue);
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById(`${category}VolumeValue`).textContent = volumeValue.toFixed(1);
            
            console.log(`${category} ë³¼ë¥¨ ì„¤ì •: ${volumeValue}`);
        }
        
        function startHoldTest() {
            const testArea = document.getElementById('holdTestArea');
            testArea.classList.add('active');
            
            soundManager.startHold();
            
            // ì£¼íŒŒìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            holdTestInterval = setInterval(() => {
                const stats = soundManager.getSoundStats();
                document.getElementById('holdFrequency').textContent = `${stats.holdSoundsPlayed}íšŒ ì¬ìƒ`;
            }, 100);
            
            const result = document.getElementById('holdResult');
            result.textContent = 'í™€ë“œ ì‚¬ìš´ë“œ ì‹œì‘...';
            result.className = 'test-result info';
        }
        
        function stopHoldTest() {
            const testArea = document.getElementById('holdTestArea');
            testArea.classList.remove('active');
            
            soundManager.endHold();
            
            if (holdTestInterval) {
                clearInterval(holdTestInterval);
            }
            
            const result = document.getElementById('holdResult');
            result.textContent = 'í™€ë“œ ì‚¬ìš´ë“œ ì¢…ë£Œ';
            result.className = 'test-result success';
        }
        
        function testBasicSound() {
            soundManager.playHoldSound('basic');
            updateTestResult('timingResult', 'ê¸°ë³¸ í™€ë“œ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testPassingSound() {
            soundManager.playHoldSound('passing');
            updateTestResult('timingResult', 'í•©ê²© êµ¬ê°„ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testPerfectSound() {
            soundManager.playHoldSound('perfect');
            updateTestResult('timingResult', 'ì™„ë²½í•œ íƒ€ì´ë° ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testOverflowSound() {
            soundManager.playHoldSound('overflow');
            updateTestResult('timingResult', 'ë„˜ì¹¨ ì‚¬ìš´ë“œ ì¬ìƒ (ë£¨í”„)', 'info');
        }
        
        function testReleaseEarly() {
            soundManager.playReleaseSound('tooEarly');
            updateTestResult('releaseResult', 'ë¹ ë¥¸ ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testReleaseSuccess() {
            soundManager.playReleaseSound('success');
            updateTestResult('releaseResult', 'ì„±ê³µ ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testReleasePerfect() {
            soundManager.playReleaseSound('perfect');
            updateTestResult('releaseResult', 'ì™„ë²½í•œ ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function testReleaseOverflow() {
            soundManager.playReleaseSound('overflow');
            updateTestResult('releaseResult', 'ë„˜ì¹¨ ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ ì¬ìƒ', 'info');
        }
        
        function updateTestResult(elementId, message, type) {
            const result = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            result.textContent = `[${timestamp}] ${message}`;
            result.className = `test-result ${type}`;
        }
        
        function testFallbackSounds() {
            const result = document.getElementById('fallbackResult');
            let output = 'í´ë°± ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸:\n\n';
            
            try {
                // ëª¨ë“  í´ë°± ì‚¬ìš´ë“œ ìƒì„±
                const soundNames = [
                    'hold-basic', 'hold-passing', 'hold-perfect', 'hold-overflow',
                    'release-early', 'release-success', 'release-perfect', 'release-overflow'
                ];
                
                let successCount = 0;
                for (const name of soundNames) {
                    try {
                        soundManager.createFallbackSound(name);
                        successCount++;
                        output += `âœ… ${name}: ìƒì„± ì„±ê³µ\n`;
                    } catch (error) {
                        output += `âŒ ${name}: ìƒì„± ì‹¤íŒ¨\n`;
                    }
                }
                
                output += `\nì´ ${successCount}/${soundNames.length}ê°œ í´ë°± ì‚¬ìš´ë“œ ìƒì„± ì™„ë£Œ`;
                
                result.textContent = output;
                result.className = successCount === soundNames.length ? 'test-result success' : 'test-result warning';
            } catch (error) {
                result.textContent = `ì—ëŸ¬: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function testFrequencyRange() {
            const result = document.getElementById('fallbackResult');
            let output = result.textContent + '\n\nì£¼íŒŒìˆ˜ ë²”ìœ„ í…ŒìŠ¤íŠ¸:\n';
            
            const frequencies = {
                'hold-basic': 220,
                'hold-passing': 330,
                'hold-perfect': 550,
                'hold-overflow': 180,
                'release-early': 200,
                'release-success': 523,
                'release-perfect': 659,
                'release-overflow': 150
            };
            
            for (const [name, freq] of Object.entries(frequencies)) {
                output += `${name}: ${freq}Hz\n`;
            }
            
            result.textContent = output;
            result.className = 'test-result info';
        }
        
        function updateSoundStats() {
            try {
                const stats = soundManager.getSoundStats();
                
                document.getElementById('soundsLoaded').textContent = stats.soundsLoaded;
                document.getElementById('soundsPlayed').textContent = stats.soundsPlayed;
                document.getElementById('holdSoundsPlayed').textContent = stats.holdSoundsPlayed;
                document.getElementById('releaseSoundsPlayed').textContent = stats.releaseSoundsPlayed;
                
                const result = document.getElementById('statsResult');
                let output = 'ì‚¬ìš´ë“œ í†µê³„:\n\n';
                output += `ì´ˆê¸°í™” ìƒíƒœ: ${stats.isInitialized ? 'ì™„ë£Œ' : 'ì‹¤íŒ¨'}\n`;
                output += `ë¡œë”©ëœ ì‚¬ìš´ë“œ: ${stats.soundsLoaded}\n`;
                output += `ì´ ì¬ìƒ íšŸìˆ˜: ${stats.soundsPlayed}\n`;
                output += `í™€ë“œ ì‚¬ìš´ë“œ: ${stats.holdSoundsPlayed}\n`;
                output += `ë¦´ë¦¬ì¦ˆ ì‚¬ìš´ë“œ: ${stats.releaseSoundsPlayed}\n`;
                output += `ë§ˆìŠ¤í„° ë³¼ë¥¨: ${stats.masterVolume}\n`;
                
                result.textContent = output;
                result.className = 'test-result success';
            } catch (error) {
                const result = document.getElementById('statsResult');
                result.textContent = `ì—ëŸ¬: ${error.message}`;
                result.className = 'test-result error';
            }
        }
        
        function clearSoundStats() {
            soundManager.reset();
            updateSoundStats();
            
            const result = document.getElementById('statsResult');
            result.textContent = 'ì‚¬ìš´ë“œ í†µê³„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.';
            result.className = 'test-result info';
        }
        
        function runAllSoundTests() {
            const result = document.getElementById('allResult');
            result.textContent = 'ì „ì²´ ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...\n\n';
            result.className = 'test-result info';
            
            setTimeout(() => {
                try {
                    checkAudioContext();
                    testFallbackSounds();
                    testBasicSound();
                    setTimeout(() => testPassingSound(), 500);
                    setTimeout(() => testPerfectSound(), 1000);
                    setTimeout(() => testReleaseSuccess(), 1500);
                    setTimeout(() => testReleasePerfect(), 2000);
                    setTimeout(() => updateSoundStats(), 2500);
                    
                    result.textContent = 'âœ… ëª¨ë“  ì‚¬ìš´ë“œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\n\nê° ì‚¬ìš´ë“œê°€ ìˆœì°¨ì ìœ¼ë¡œ ì¬ìƒë©ë‹ˆë‹¤.';
                    result.className = 'test-result success';
                } catch (error) {
                    result.textContent = `âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì—ëŸ¬: ${error.message}`;
                    result.className = 'test-result error';
                }
            }, 100);
        }
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            if (statsInterval) {
                clearInterval(statsInterval);
            }
            if (holdTestInterval) {
                clearInterval(holdTestInterval);
            }
        });
    </script>
</body>
</html>
