<!DOCTYPE html>
<html lang="{{LANG}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Cache Prevention - Force fresh version on every visit -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- SEO Meta Tags (Dynamically replaced by Cloudflare Workers) -->
    <meta name="description" content="{{DESCRIPTION}}">
    <meta name="keywords" content="{{KEYWORDS}}">

    <title data-i18n="auto_battle_card_game.page_title">{{PAGE_TITLE}}</title>

    <!-- Supabase JS SDK (for version check and leaderboard) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Canonical & Language Alternate URLs (hreflang) -->
    <link rel="canonical" href="https://binboxgames.com/games/card-battle-game/?lang={{LANG}}">
    <link rel="alternate" hreflang="ko" href="https://binboxgames.com/games/card-battle-game/?lang=ko">
    <link rel="alternate" hreflang="en" href="https://binboxgames.com/games/card-battle-game/?lang=en">
    <link rel="alternate" hreflang="ja" href="https://binboxgames.com/games/card-battle-game/?lang=ja">
    <link rel="alternate" hreflang="x-default" href="https://binboxgames.com/games/card-battle-game/?lang=en">

    <!-- Open Graph / SNS Meta Tags (Dynamically replaced by Cloudflare Workers) -->
    <meta property="og:title" content="{{OG_TITLE}}">
    <meta property="og:description" content="{{OG_DESCRIPTION}}">
    <meta property="og:image" content="{{OG_IMAGE}}">
    <meta property="og:url" content="https://binboxgames.com/games/card-battle-game/?lang={{LANG}}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="BinBox Games">

    <!-- Twitter Card Meta Tags (Dynamically replaced by Cloudflare Workers) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{TWITTER_TITLE}}">
    <meta name="twitter:description" content="{{TWITTER_DESCRIPTION}}">
    <meta name="twitter:image" content="{{TWITTER_IMAGE}}">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚔️</text></svg>">
    <link rel="stylesheet" href="style.css?v=0.9.16">
    <link rel="stylesheet" href="css/components.css?v=0.9.16">

    <!-- 공유 링크 조기 감지 스크립트 (head에서 즉시 실행) -->
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareParam = urlParams.get('share');

            if (shareParam) {
                console.log('[Early Script] 공유 링크 감지 - 로딩 화면 숨김 준비');

                // DOM 로드 즉시 실행
                window.addEventListener('DOMContentLoaded', function() {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                        loadingScreen.style.visibility = 'hidden';
                        loadingScreen.style.opacity = '0';
                        loadingScreen.style.pointerEvents = 'none';
                        loadingScreen.style.zIndex = '-1';
                        console.log('[Early Script] 로딩 화면 즉시 숨김 완료');
                    } else {
                        console.error('[Early Script] loading-screen 요소를 찾을 수 없습니다');
                    }
                });
            }
        })();
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1398958608599791"
     crossorigin="anonymous"></script>
</head>
<body>

    <!-- 로딩 화면 -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <h1 class="loading-title" data-i18n="auto_battle_card_game.ui.loading_title">⚔️ 자동전투 카드대전</h1>
            <div class="loading-message" data-i18n="auto_battle_card_game.ui.loading_message">게임 로딩 중...</div>
            <div class="loading-bar-container">
                <div class="loading-bar-fill" id="loading-bar-fill"></div>
            </div>
            <div class="loading-progress-text" id="loading-progress-text">0/0 files loaded</div>
            <button id="loading-start-button" class="loading-start-button hidden" data-i18n="auto_battle_card_game.ui.click_to_start">클릭하여 시작</button>
        </div>
    </div>

    <div class="game-container">
        <!-- 언어 선택기 -->
        <div class="language-selector">
            <select id="languageSelect">
                <option value="ko">🇰🇷</option>
                <option value="en">🇺🇸</option>
                <option value="ja">🇯🇵</option>
            </select>
        </div>

        <!-- 게임 래퍼 (Canvas + UI 오버레이) -->
        <div class="game-wrapper">
            <!-- 메인 캔버스 - GameConfig 기반 동적 크기 -->
            <canvas id="gameCanvas" width="750" height="1200"></canvas>

            <!-- UI 오버레이 -->
            <div id="ui-overlay" class="ui-overlay">
            <!-- HP 바들 -->
            <!-- 적 효과 컨테이너들 -->
            <div id="enemy-effects-container" class="effects-container enemy-effects">
                <div id="enemy-status-effects-grid" class="status-effects-grid enemy-status"></div>
                <div id="enemy-buffs-grid" class="buffs-grid enemy-buffs"></div>
            </div>

            <div id="enemy-hp-bar" class="hp-bar-container hp-bar-enemy">
                <div class="hp-bar-fill" style="width: 100%;"></div>
                <!-- 방어력 오버레이 -->
                <div class="defense-overlay" style="width: 0%;"></div>
                <div class="hp-bar-text">
                    <span class="entity-name">적</span>
                    <span class="hp-info">HP: <span class="hp-number">10/10</span></span>
                    <span class="defense-info hidden"><span class="defense-number-overlay">0</span></span>
                </div>
            </div>

            <!-- 적 방어속성 배지 (이름 아래) -->
            <div class="defense-badge-wrapper badge-below">
                <div class="defense-element-badge normal" id="enemy-defense-element">
                    <span class="badge-emoji">🛡️</span>
                    <span class="badge-text">노멀</span>
                </div>
            </div>

            <!-- 플레이어 방어속성 배지 (이름 위) -->
            <div class="defense-badge-wrapper badge-above">
                <div class="defense-element-badge normal" id="player-defense-element">
                    <span class="badge-emoji">🛡️</span>
                    <span class="badge-text">노멀</span>
                </div>
            </div>

            <!-- 플레이어 효과 컨테이너들 -->
            <div id="player-effects-container" class="effects-container player-effects">
                <div id="player-status-effects-grid" class="status-effects-grid player-status"></div>
                <div id="player-buffs-grid" class="buffs-grid player-buffs"></div>
            </div>

            <div id="player-hp-bar" class="hp-bar-container hp-bar-player">
                <div class="hp-bar-fill" style="width: 100%;"></div>
                <!-- 방어력 오버레이 -->
                <div class="defense-overlay" style="width: 0%;"></div>
                <div class="hp-bar-text">
                    <span class="entity-name">플레이어</span>
                    <span class="hp-info">HP: <span class="hp-number">10/10</span></span>
                    <span class="defense-info hidden"><span class="defense-number-overlay">0</span></span>
                </div>
            </div>

            <!-- 게임 속도 조절 (JavaScript가 초기 active 상태 설정) -->
            <div class="speed-controls">
                <button id="speed-1x" class="speed-btn" data-i18n="auto_battle_card_game.ui.speed_slow">느림</button>
                <button id="speed-2x" class="speed-btn" data-i18n="auto_battle_card_game.ui.speed_normal">보통</button>
                <button id="speed-3x" class="speed-btn" data-i18n="auto_battle_card_game.ui.speed_fast">빠름</button>
                <button id="speed-5x" class="speed-btn" data-i18n="auto_battle_card_game.ui.speed_very_fast">매우빠름</button>
            </div>

            <!-- 메인 메뉴 DOM 버튼들 (Canvas 메뉴 대체) -->
            <div id="main-menu-buttons" class="main-menu-container" style="display: flex;">
                <button class="menu-button" id="game-tutorial-btn">
                    <span class="menu-icon">📚</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.game_tutorial">게임 설명</span>
                </button>
                <button class="menu-button" id="continue-game-btn" disabled>
                    <span class="menu-icon">▶️</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.continue_game">이어서 하기</span>
                </button>
                <button class="menu-button" id="start-game-btn">
                    <span class="menu-icon">⚔️</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.new_game">새 게임 시작</span>
                </button>
                <button class="menu-button" id="card-gallery-menu-btn">
                    <span class="menu-icon">🃏</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.card_gallery">카드 갤러리</span>
                </button>
                <button class="menu-button" id="leaderboard-menu-btn">
                    <span class="menu-icon">🏆</span>
                    <span class="menu-text" data-i18n="leaderboard.title">리더보드</span>
                </button>
                <button class="menu-button" id="settings-menu-btn">
                    <span class="menu-icon">🔊</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.settings">볼륨</span>
                </button>
                <button class="menu-button" id="back-to-main-menu-btn">
                    <span class="menu-icon">🏠</span>
                    <span class="menu-text" data-i18n="auto_battle_card_game.ui.back_to_homepage">홈페이지로</span>
                </button>
            </div>

            <!-- 카드 갤러리 버튼 -->
            <button id="card-gallery-btn" class="ui-button" data-i18n="auto_battle_card_game.ui.view_all_cards">모든 카드 보기</button>


            <!-- 메뉴화면으로 돌아가기 버튼 -->
            <button id="back-to-menu" class="ui-button back-btn menu-btn" data-i18n="auto_battle_card_game.ui.back_to_menu">←</button>

            <!-- 스테이지 인디케이터 -->
            <div id="stage-indicator" class="stage-indicator hidden">
                <span class="stage-icon">🏆</span>
                <span class="stage-text">Stage 1</span>
                <span class="stage-progress">●○○○○○○○○○</span>
            </div>

            <!-- 턴 인디케이터 (동적으로 생성) -->
            <div id="turn-indicator-container"></div>

            <!-- 대미지/효과 숫자 컨테이너 (동적으로 생성) -->
            <div id="numbers-container"></div>

            <!-- 효과 오버레이 컨테이너 (동적으로 생성) -->
            <div id="effects-container"></div>
        </div>

        <!-- 인게임 볼륨 컨트롤 (ui-overlay 외부 배치 - z-index 독립) -->
        <!-- 인게임 볼륨 조절 버튼 -->
        <button id="volume-control-btn" class="ui-button volume-btn" title="Volume">🔊</button>

        <!-- 인게임 공유 버튼 (배틀 중 손패 공유) -->
        <button id="battle-share-btn" class="ui-button share-btn hidden" title="Share Hand" data-i18n-title="auto_battle_card_game.ui.share_hand_button">📤</button>

        <!-- 인게임 볼륨 팝업 패널 -->
        <div id="volume-popup-panel" class="volume-popup-panel hidden">
            <button id="ingame-mute-toggle" class="mute-toggle-button">
                <span class="mute-button-text" data-i18n="auto_battle_card_game.ui.mute_for_external">🔇 음소거 (외부 프로그램 오디오 재생가능)</span>
                <span class="mute-checkbox">
                    <span class="mute-checkbox-inner"></span>
                </span>
            </button>
            <div class="volume-slider-group">
                <div class="volume-label-row">
                    <span class="volume-icon">🎵</span>
                    <span class="volume-label" data-i18n="auto_battle_card_game.ui.bgm_label">음악</span>
                    <span class="volume-value" id="ingame-bgm-value">60%</span>
                </div>
                <input type="range" id="ingame-bgm-slider" class="volume-slider" min="0" max="100" value="60">
            </div>
            <div class="volume-slider-group">
                <div class="volume-label-row">
                    <span class="volume-icon">🔊</span>
                    <span class="volume-label" data-i18n="auto_battle_card_game.ui.sfx_label">효과음</span>
                    <span class="volume-value" id="ingame-sfx-value">80%</span>
                </div>
                <input type="range" id="ingame-sfx-slider" class="volume-slider" min="0" max="100" value="80">
            </div>
        </div>

        <!-- 카드 갤러리 모달 -->
        <div id="card-gallery-modal" class="modal hidden">
            <div class="modal-content glass-morphism">
                <!-- 카드 갤러리 제목 행 (제목: 중앙, 카드 개수: 오른쪽) -->
                <div class="card-gallery-title-row">
                    <h2 class="card-gallery-title" data-i18n="auto_battle_card_game.ui.card_gallery_title">카드 갤러리</h2>
                    <div class="card-count-display" id="card-count-display">
                        <span data-i18n="auto_battle_card_game.ui.total_cards">총</span> <span id="card-count-number">0</span><span data-i18n="auto_battle_card_game.ui.cards_unit">장</span>
                    </div>
                </div>

                <!-- 카드 갤러리 필터 컨트롤 (중앙 정렬) -->
                <div class="card-gallery-controls">
                    <div class="element-filter-container" id="element-filter-container">
                        <!-- 속성 필터 버튼들이 동적으로 생성됨 -->
                    </div>
                </div>

                <!-- 카드 그리드 -->
                <div id="card-gallery-grid" class="card-gallery-grid"></div>

                <!-- 닫기 버튼 -->
                <button id="close-gallery" class="ui-button" data-i18n="auto_battle_card_game.ui.close">닫기</button>
            </div>
        </div>

        <!-- 설정 모달 -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content glass-morphism settings-modal-content">
                <h2>🔊 <span data-i18n="auto_battle_card_game.ui.settings">볼륨</span></h2>
                <div class="settings-body">
                    <button id="settings-mute-toggle" class="mute-toggle-button">
                        <span class="mute-button-text" data-i18n="auto_battle_card_game.ui.mute_for_external">🔇 음소거 (외부 프로그램 오디오 재생가능)</span>
                        <span class="mute-checkbox">
                            <span class="mute-checkbox-inner"></span>
                        </span>
                    </button>
                    <!-- BGM 볼륨 -->
                    <div class="volume-setting-group">
                        <div class="volume-setting-label-row">
                            <span class="volume-setting-icon">🎵</span>
                            <span class="volume-setting-label" data-i18n="auto_battle_card_game.ui.bgm_label">음악</span>
                            <span class="volume-setting-value" id="settings-bgm-value">60%</span>
                        </div>
                        <input type="range" id="settings-bgm-slider" class="volume-setting-slider" min="0" max="100" value="60">
                    </div>

                    <!-- SFX 볼륨 -->
                    <div class="volume-setting-group">
                        <div class="volume-setting-label-row">
                            <span class="volume-setting-icon">🔊</span>
                            <span class="volume-setting-label" data-i18n="auto_battle_card_game.ui.sfx_label">효과음</span>
                            <span class="volume-setting-value" id="settings-sfx-value">80%</span>
                        </div>
                        <input type="range" id="settings-sfx-slider" class="volume-setting-slider" min="0" max="100" value="80">
                    </div>
                </div>
                <button id="close-settings" class="ui-button primary" data-i18n="auto_battle_card_game.ui.close">닫기</button>
            </div>
        </div>

        <!-- 갤러리 카드 상세 모달 -->
        <div id="gallery-card-detail-modal" class="modal hidden">
            <div class="modal-content glass-morphism">
                <div id="gallery-card-detail-content" class="card-detail-display"></div>
                <div class="modal-buttons">
                    <button id="gallery-card-detail-close" class="ui-button" data-i18n="auto_battle_card_game.ui.close">닫기</button>
                </div>
            </div>
        </div>

        <!-- 플레이어 이름 입력 모달 -->
        <div id="player-name-modal" class="modal hidden">
            <div class="modal-content glass-morphism">
                <h2 data-i18n="auto_battle_card_game.ui.enter_player_name">플레이어 이름 입력</h2>
                <div class="name-input-container">
                    <input type="text" id="player-name-input" class="name-input"
                           data-i18n-placeholder="auto_battle_card_game.ui.name_placeholder"
                           placeholder="이름을 입력하세요" maxlength="20">
                    <div class="name-length-counter">
                        <span id="current-name-length">0</span> / <span id="max-name-length">20</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="confirm-name" class="ui-button primary" data-i18n="auto_battle_card_game.ui.confirm">확인</button>
                    <button id="cancel-name" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
                </div>
            </div>
        </div>

        <!-- 카드 선택 모달 -->
        <div id="card-selection-modal" class="modal hidden">
            <div class="modal-content glass-morphism">
                <h2 data-i18n="auto_battle_card_game.ui.card_selection.initial_title">시작 카드 선택</h2>
                <p class="selection-instruction" data-i18n="auto_battle_card_game.ui.card_selection.instruction">공격 카드를 선택하여 게임을 시작하세요!</p>
                <div id="card-selection-grid" class="card-selection-grid"></div>
                <div class="card-selection-footer">
                    <button id="card-selection-cancel" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.go_back">뒤로가기</button>
                </div>
            </div>
        </div>

        <!-- 카드 상세 모달 (카드 선택 시 확대 표시) -->
        <div id="card-detail-modal" class="modal hidden">
            <div class="modal-content glass-morphism card-detail-content">
                <h2 data-i18n="auto_battle_card_game.ui.card_detail_title">카드 상세 정보</h2>
                <div id="card-detail-content" class="card-detail-display"></div>
                <div class="modal-buttons">
                    <button id="card-detail-select" class="ui-button primary" data-i18n="auto_battle_card_game.ui.select">선택</button>
                    <button id="card-detail-cancel" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
                </div>
            </div>
        </div>

        <!-- 게임 설명 모달 -->
        <div id="game-tutorial-modal" class="modal hidden">
            <div class="modal-content glass-morphism tutorial-modal">
                <h2 data-i18n="auto_battle_card_game.ui.game_tutorial">게임 설명</h2>

                <!-- 기본 게임 플레이 가이드 -->
                <div class="tutorial-section basic-guide">
                    <h3 data-i18n="auto_battle_card_game.tutorial.basic_gameplay">🎮 기본 플레이 방법</h3>
                    <div class="tutorial-content">
                        <p data-i18n="auto_battle_card_game.tutorial.line1">공격카드 중 하나를 선택하여 게임을 시작하세요!</p>
                        <p data-i18n="auto_battle_card_game.tutorial.line2">카드는 손패 왼쪽부터 자동으로 발동됩니다!</p>
                        <p data-i18n="auto_battle_card_game.tutorial.line3">각 스테이지 클리어 시 랜덤으로 등장하는 세개의 카드 중에 하나를 선택하여 손패 왼쪽에 가져옵니다!</p>
                        <p data-i18n="auto_battle_card_game.tutorial.line4">최대 손패 카드는 10장입니다! 스테이지 클리어시 카드를 선택하여 추가, 손패의 카드와 교체, 다음 스테이지로 스킵 중에 선택 가능합니다!</p>
                        <p data-i18n="auto_battle_card_game.tutorial.line5">몇 스테이지까지 갈 수 있을까요! 당신의 운을 시험해보세요!</p>
                    </div>
                </div>

                <!-- 카드 스탯 가이드 -->
                <div class="tutorial-section card-stats-guide">
                    <h3 data-i18n="auto_battle_card_game.tutorial.card_stats">📊 카드 스탯 표시</h3>
                    <div class="tutorial-content">
                        <p data-i18n="auto_battle_card_game.tutorial.stat_power">⚔️ 공격력: 카드가 입히는 피해량</p>
                        <p data-i18n="auto_battle_card_game.tutorial.stat_accuracy">🎯 명중률: 카드 발동 성공 확률 (100% = 항상 성공)</p>
                        <p data-i18n="auto_battle_card_game.tutorial.stat_activation">🔄 발동횟수: 한 턴에 카드가 발동되는 횟수</p>
                        <p data-i18n="auto_battle_card_game.tutorial.stat_note" data-i18n-parse>💡 카드 위에 마우스를 올리면 자세한 정보를 확인할 수 있습니다</p>
                    </div>
                </div>

                <!-- 속성 상성 가이드 -->
                <div class="tutorial-section element-guide">
                    <h3 data-i18n="auto_battle_card_game.tutorial.element_system">⚔️ 속성 상성 시스템</h3>
                    <div class="element-effectiveness">
                        <!-- 헤더 라벨 row -->
                        <div class="element-header-row">
                            <span class="header-label-left" data-i18n="auto_battle_card_game.tutorial.attack_card_element">공격카드 속성</span>
                            <span class="header-arrow">→</span>
                            <span class="header-label-right" data-i18n="auto_battle_card_game.tutorial.defense_element">방어속성</span>
                        </div>
                        <div class="effectiveness-row">
                            <div class="element-item fire">
                                <span class="element-emoji">🔥</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.fire">불</span>
                            </div>
                            <div class="effectiveness-center">
                                <span class="effectiveness-arrow">→</span>
                                <span class="effectiveness-text strong" data-i18n="auto_battle_card_game.tutorial.strong">강점 1.5배</span>
                            </div>
                            <div class="element-item poison strong">
                                <span class="element-emoji">☠️</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.poison">독</span>
                            </div>
                        </div>
                        <div class="effectiveness-row">
                            <div class="element-item poison">
                                <span class="element-emoji">☠️</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.poison">독</span>
                            </div>
                            <div class="effectiveness-center">
                                <span class="effectiveness-arrow">→</span>
                                <span class="effectiveness-text strong" data-i18n="auto_battle_card_game.tutorial.strong">강점 1.5배</span>
                            </div>
                            <div class="element-item electric strong">
                                <span class="element-emoji">⚡</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.electric">전기</span>
                            </div>
                        </div>
                        <div class="effectiveness-row">
                            <div class="element-item electric">
                                <span class="element-emoji">⚡</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.electric">전기</span>
                            </div>
                            <div class="effectiveness-center">
                                <span class="effectiveness-arrow">→</span>
                                <span class="effectiveness-text strong" data-i18n="auto_battle_card_game.tutorial.strong">강점 1.5배</span>
                            </div>
                            <div class="element-item water strong">
                                <span class="element-emoji">💧</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.water">물</span>
                            </div>
                        </div>
                        <div class="effectiveness-row">
                            <div class="element-item water">
                                <span class="element-emoji">💧</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.water">물</span>
                            </div>
                            <div class="effectiveness-center">
                                <span class="effectiveness-arrow">→</span>
                                <span class="effectiveness-text strong" data-i18n="auto_battle_card_game.tutorial.strong">강점 1.5배</span>
                            </div>
                            <div class="element-item fire strong">
                                <span class="element-emoji">🔥</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.fire">불</span>
                            </div>
                        </div>
                        <!-- 노멀 속성 row -->
                        <div class="effectiveness-row neutral">
                            <div class="element-item normal">
                                <span class="element-emoji">👊</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.ui.elements.normal">노멀</span>
                            </div>
                            <div class="effectiveness-center">
                                <span class="effectiveness-arrow">⇄</span>
                                <span class="effectiveness-text neutral" data-i18n="auto_battle_card_game.tutorial.neutral">균형 1.0배</span>
                            </div>
                            <div class="element-items-all">
                                <span class="element-emojis-small">🔥💧⚡☠️</span>
                                <span class="element-name" data-i18n="auto_battle_card_game.tutorial.all_elements">모든 속성</span>
                            </div>
                        </div>
                    </div>
                    <div class="element-notes">
                        <p class="element-note weakness" data-i18n="auto_battle_card_game.tutorial.weakness_note">⚠️ 약점으로 공격하면 0.5배 대미지로 감소합니다!</p>
                    </div>
                </div>

                <!-- 속성 방어 시스템 -->
                <div class="tutorial-section defense-guide">
                    <h3 data-i18n="auto_battle_card_game.tutorial.defense_system">👊🔥💧⚡☠️ 방어속성은 어떻게 정해지나?</h3>
                    <div class="defense-explanation">
                        <p data-i18n="auto_battle_card_game.tutorial.defense_line1">🔄 손패의 카드 속성에 따라 자동으로 방어 속성이 결정됩니다</p>
                        <p data-i18n="auto_battle_card_game.tutorial.defense_line2">📊 가장 많은 속성의 카드가 방어 속성이 됩니다</p>
                        <p data-i18n="auto_battle_card_game.tutorial.defense_line2_1">💫 노멀 카드가 여러 장 있어도 속성 카드 하나만 섞이면 그 속성으로 변경됩니다</p>
                        <p data-i18n="auto_battle_card_game.tutorial.defense_line3">⚖️ 같은 수의 카드를 가진 속성끼리는 상쇄되어 👊 노멀 방어가 됩니다</p>
                        <p data-i18n="auto_battle_card_game.tutorial.defense_line6">💯 노멀 방어는 모든 속성 공격에 1.0배 대미지 (강점/약점 없음)</p>
                    </div>
                </div>

                <!-- 리더보드 정렬 기준 -->
                <div class="tutorial-section leaderboard-ranking-guide">
                    <h3 data-i18n="auto_battle_card_game.tutorial.leaderboard_ranking">🏆 전세계 순위 정렬 기준</h3>
                    <div class="ranking-criteria">
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_1">1순위: 게임 클리어 여부 (클리어 > 미클리어)</p>
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_2">2순위: 높은 스테이지</p>
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_3">3순위: 최신 게임 버전</p>
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_4">4순위: 적은 턴수</p>
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_5">5순위: 적은 딜량</p>
                        <p data-i18n="auto_battle_card_game.tutorial.rank_priority_6">6순위: 높은 받은 피해</p>
                    </div>
                </div>

                <button id="close-tutorial" class="ui-button primary" data-i18n="auto_battle_card_game.ui.close">닫기</button>
            </div>
        </div>

        <!-- 승리 모달 -->
        <div id="victory-modal" class="modal hidden">
            <div class="modal-content victory-content glass-morphism">
                <div class="victory-header">
                    <h2><span data-i18n="auto_battle_card_game.ui.stage_text">Stage</span> <span id="victory-stage-number">1</span> <span data-i18n="auto_battle_card_game.ui.clear_text">Clear!</span></h2>
                    <p class="victory-reward-text" data-i18n="auto_battle_card_game.ui.choose_reward_card_exclaim">Choose a reward card!</p>
                    <p class="victory-option-text" data-i18n="auto_battle_card_game.ui.reward_options">손패에 추가하거나, 손패 카드와 교체하거나, 스킵 할 수 있습니다</p>
                </div>

                <div class="victory-content-area">

                    <!-- 카드 보상 선택 영역 -->
                    <div id="victory-card-rewards" class="card-rewards-container hidden">
                        <div class="reward-cards-grid">
                            <div class="reward-card" data-card-index="0"></div>
                            <div class="reward-card" data-card-index="1"></div>
                            <div class="reward-card" data-card-index="2"></div>
                            <div class="reward-card" data-card-index="3"></div>
                        </div>
                        <p class="card-selection-hint" data-i18n="auto_battle_card_game.ui.card_selection_hint">카드 선택 시 확대됩니다</p>
                    </div>

                    <!-- 선택된 카드 확대 표시 영역 -->
                    <div id="selected-card-detail" class="selected-card-detail hidden">
                        <!-- 선택된 카드의 확대 이미지가 여기에 표시됨 -->
                    </div>

                    <!-- 손패 교체 선택 영역 -->
                    <div id="victory-hand-replace" class="hand-replace-container hidden">
                        <h3 data-i18n="auto_battle_card_game.ui.hand_replace_title">손패 카드 교체</h3>
                        <p data-i18n="auto_battle_card_game.ui.choose_card_to_replace">교체할 손패 카드를 선택하세요</p>
                        <div class="hand-cards-grid" id="hand-cards-for-replace">
                            <!-- 손패 카드들이 동적으로 표시됨 -->
                        </div>
                        <p class="card-selection-hint" data-i18n="auto_battle_card_game.ui.card_selection_hint">카드 선택 시 확대됩니다</p>
                        <button id="cancel-replace-btn" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
                    </div>

                    <!-- 선택된 손패 카드 확대 표시 영역 -->
                    <div id="selected-hand-card-detail" class="selected-card-detail hidden">
                        <!-- 선택된 손패 카드의 확대 이미지가 여기에 표시됨 -->
                    </div>
                </div>

                <div class="modal-buttons">
                    <!-- 손패 확인 버튼 (1행 중앙) -->
                    <div id="victory-view-hand-row" class="button-group">
                        <button id="victory-view-hand" class="ui-button view-hand-button" data-i18n="auto_battle_card_game.ui.view_hand_cards">손패 확인</button>
                    </div>
                    <!-- 기본 상태: 다시뽑기(강조), 스킵 버튼, 계속하기 (2행) -->
                    <div id="victory-default-buttons" class="button-group">
                        <button id="victory-reroll" class="ui-button primary reroll-button" data-i18n="auto_battle_card_game.ui.reroll_reward">다시뽑기</button>
                        <button id="victory-skip" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.skip_reward">보상 건너뛰기</button>
                        <button id="victory-continue" class="ui-button primary hidden" data-i18n="auto_battle_card_game.ui.continue">계속하기</button>
                    </div>
                    <!-- 공유 버튼 (3행 중앙) - 보상 카드 선택 화면에서만 표시 -->
                    <div id="victory-share-row" class="button-group hidden">
                        <button id="victory-share" class="ui-button share-button" data-i18n="auto_battle_card_game.ui.share_button">📤 공유하기</button>
                    </div>

                    <!-- 카드 선택 후: 덱 추가 또는 교체 선택 -->
                    <div id="victory-selection-buttons" class="button-group hidden">
                        <button id="victory-add-to-deck" class="ui-button primary" data-i18n="auto_battle_card_game.ui.add_to_deck">덱에 추가</button>
                        <button id="victory-replace-card" class="ui-button success" data-i18n="auto_battle_card_game.ui.replace_hand_card">손패와 교체</button>
                        <button id="victory-cancel-selection" class="ui-button" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
                    </div>

                    <!-- 손패 카드 선택 확인 버튼 -->
                    <div id="victory-hand-confirmation-buttons" class="button-group hidden">
                        <button id="victory-confirm-replacement" class="ui-button primary" data-i18n="auto_battle_card_game.ui.replace_card_button">바꾸기</button>
                        <button id="victory-cancel-hand-selection" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 패배 모달 -->
        <div id="defeat-modal" class="modal hidden">
            <div class="modal-content defeat-content glass-morphism">
                <h2 data-i18n="auto_battle_card_game.ui.defeat_title">게임 오버</h2>
                <div class="defeat-info">
                    <div class="player-info">
                        <p><span data-i18n="auto_battle_card_game.ui.player_name">플레이어:</span> <span id="defeat-player-name">플레이어</span></p>
                        <p><span data-i18n="auto_battle_card_game.ui.final_stage">도달 스테이지:</span> <span id="defeat-final-stage">1</span></p>
                    </div>
                    <div class="game-stats">
                        <h3 data-i18n="auto_battle_card_game.ui.game_statistics">게임 통계</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="auto_battle_card_game.ui.total_turns">총 턴수:</span>
                                <span class="stat-value" id="defeat-total-turns">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="auto_battle_card_game.ui.total_damage_dealt">총 딜량:</span>
                                <span class="stat-value" id="defeat-damage-dealt">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="auto_battle_card_game.ui.total_damage_received">받은 피해:</span>
                                <span class="stat-value" id="defeat-damage-received">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="auto_battle_card_game.ui.defense_built">방어력 구축:</span>
                                <span class="stat-value" id="defeat-defense-built">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="auto_battle_card_game.ui.critical_hits">크리티컬:</span>
                                <span class="stat-value" id="defeat-critical-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label" data-i18n="leaderboard.global_rank_label">글로벌 순위:</span>
                                <span class="stat-value" id="defeat-play-style">-</span>
                            </div>
                        </div>
                        <div class="mvp-card" id="defeat-mvp-section">
                            <p><span data-i18n="auto_battle_card_game.ui.final_hand">최종 손패:</span></p>
                            <div id="defeat-mvp-card" class="mvp-card-container"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="defeat-restart" class="ui-button primary" data-i18n="auto_battle_card_game.ui.try_again">다시 도전하기</button>
                    <button id="defeat-main-menu" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.main_menu">메인 메뉴로</button>
                    <button id="defeat-share" class="ui-button share-button" data-i18n="auto_battle_card_game.ui.share_button">📤 공유하기</button>
                </div>
            </div>
        </div>

        <!-- 버프/상태이상 툴팁 모달 -->
        <div id="tooltip-modal" class="modal hidden tooltip-modal">
            <div class="tooltip-modal-content">
                <div class="tooltip-header">
                    <span class="tooltip-emoji"></span>
                    <span class="tooltip-name"></span>
                </div>
                <div class="tooltip-description"></div>
            </div>
        </div>

        <!-- 공유 모달 (플랫폼 선택) -->
        <div id="share-modal" class="modal hidden">
            <div class="modal-content share-modal-content glass-morphism">
                <h3 data-i18n="auto_battle_card_game.ui.share_title">📤 공유하기</h3>
                <div class="share-platforms">
                    <button id="share-twitter" class="platform-button twitter">
                        <span class="platform-icon">🐦</span>
                        <span class="platform-text" data-i18n="auto_battle_card_game.ui.share_twitter">Twitter/X</span>
                    </button>
                    <button id="share-facebook" class="platform-button facebook">
                        <span class="platform-icon">📘</span>
                        <span class="platform-text" data-i18n="auto_battle_card_game.ui.share_facebook">Facebook</span>
                    </button>
                    <button id="share-discord" class="platform-button discord">
                        <span class="platform-icon">💬</span>
                        <span class="platform-text" data-i18n="auto_battle_card_game.ui.share_discord">Discord</span>
                    </button>
                    <button id="share-copy" class="platform-button copy">
                        <span class="platform-icon">🔗</span>
                        <span class="platform-text" data-i18n="auto_battle_card_game.ui.share_copy_url">URL 복사</span>
                    </button>
                </div>
                <button id="share-cancel" class="ui-button secondary" data-i18n="auto_battle_card_game.ui.cancel">취소</button>
            </div>
        </div>

        <!-- 공유 랜딩 페이지 모달 -->
        <div id="share-landing-modal" class="modal hidden">
            <div class="modal-content landing-content glass-morphism">
                <h2 id="landing-title" data-i18n="auto_battle_card_game.ui.share_landing_title">공유된 손패</h2>

                <!-- 손패 이미지 표시 -->
                <div class="landing-image-container">
                    <canvas id="landing-canvas"></canvas>
                </div>

                <!-- 플레이하기 버튼 -->
                <div class="modal-buttons">
                    <button id="landing-play-button" class="ui-button primary large-button" data-i18n="auto_battle_card_game.ui.play_now_button">
                        🎮 나도 플레이하기
                    </button>
                </div>

                <p class="landing-footer" data-i18n="auto_battle_card_game.ui.landing_footer">
                    BinBox Games에서 제공하는 자동전투 카드대전!
                </p>
            </div>
        </div>

        <!-- 글로벌 리더보드 모달 -->
        <div id="leaderboard-modal" class="modal hidden">
            <div class="modal-content glass-morphism leaderboard-modal-content">
                <!-- 헤더: 제목 + 검색 바 -->
                <div class="leaderboard-header">
                    <h2>🏆 <span data-i18n="leaderboard.title">글로벌 리더보드</span></h2>
                    <div class="leaderboard-search-container">
                        <input type="text"
                               id="leaderboard-search-input"
                               class="leaderboard-search-input"
                               data-i18n-placeholder="leaderboard.search_placeholder"
                               placeholder="플레이어 이름 검색">
                        <button id="leaderboard-search-btn"
                                class="ui-button secondary">🔍</button>
                    </div>
                </div>

                <!-- 리더보드 테이블 -->
                <div class="leaderboard-table-container">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th data-i18n="leaderboard.rank">순위</th>
                                <th data-i18n="leaderboard.player_name">플레이어</th>
                                <th data-i18n="leaderboard.final_stage">스테이지</th>
                                <th data-i18n="leaderboard.total_turns">턴수</th>
                                <th data-i18n="leaderboard.total_damage_dealt">딜량</th>
                                <th data-i18n="leaderboard.total_damage_received">받은피해</th>
                                <th data-i18n="leaderboard.version">버전</th>
                                <th data-i18n="leaderboard.date">날짜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 데이터가 동적으로 로드됨 -->
                        </tbody>
                    </table>
                </div>

                <!-- 페이징 컨트롤 -->
                <div class="leaderboard-pagination">
                    <button class="leaderboard-first-btn ui-button secondary" data-i18n="leaderboard.first_page">맨처음</button>
                    <button class="leaderboard-prev10-btn ui-button secondary" data-i18n="leaderboard.prev_10">←10</button>
                    <button class="leaderboard-prev-btn ui-button secondary" data-i18n="leaderboard.prev_page">이전</button>
                    <span class="leaderboard-page-info">1 / 1</span>
                    <button class="leaderboard-next-btn ui-button secondary" data-i18n="leaderboard.next_page">다음</button>
                    <button class="leaderboard-next10-btn ui-button secondary" data-i18n="leaderboard.next_10">10→</button>
                    <button class="leaderboard-last-btn ui-button secondary" data-i18n="leaderboard.last_page">맨끝</button>
                </div>

                <!-- 닫기 버튼 -->
                <button class="close-btn ui-button primary" data-i18n="auto_battle_card_game.ui.close">닫기</button>
            </div>
        </div>

    </div>

    <!-- Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- 스크립트 로드 -->
    <!-- 설정 파일들 먼저 로드 -->
    <script src="js/config/gameConfig.js?v=0.9.16"></script>
    <!-- i18n 시스템 -->
    <script src="js/i18n.js?v=0.9.16"></script>
    <!-- 유틸리티 클래스들 -->
    <script src="js/utils/I18nHelper.js?v=0.9.16"></script>
    <script src="js/utils/CanvasUtils.js?v=0.9.16"></script>
    <script src="js/utils/TextRenderer.js?v=0.9.16"></script>
    <script src="js/utils/ColorUtils.js?v=0.9.16"></script>
    <script src="js/utils/TimerManager.js?v=0.9.16"></script>
    <script src="js/utils/RenderOptimizer.js?v=0.9.16"></script>
    <script src="js/utils/DescriptionParser.js?v=0.9.16"></script>
    <script src="js/utils/CryptoUtils.js?v=0.9.16"></script>
    <script src="js/config/cardDatabase.js?v=0.9.16"></script>
    <script src="js/entities/Card.js?v=0.9.16"></script>
    <script src="js/entities/Player.js?v=0.9.16"></script>
    <script src="js/entities/Enemy.js?v=0.9.16"></script>
    <!-- 오디오 시스템 -->
    <script src="js/systems/AudioSystem.js?v=0.9.16"></script>
    <!-- 공유 시스템 -->
    <script src="js/systems/ShareImageGenerator.js?v=0.9.16"></script>
    <script src="js/systems/ShareSystem.js?v=0.9.16"></script>
    <script src="js/systems/ShareLandingPage.js?v=0.9.16"></script>
    <!-- 리더보드 시스템 -->
    <script src="js/systems/LeaderboardClient.js?v=0.9.16"></script>
    <!-- 자동 버전 업데이트 시스템 -->
    <script src="js/systems/VersionChecker.js?v=0.9.16"></script>
    <script src="js/ui/HPBarSystem.js?v=0.9.16"></script>
    <script src="js/ui/BuffStatusTooltipModal.js?v=0.9.16"></script>
    <script src="js/ui/EffectSystem.js?v=0.9.16"></script>
    <!-- UI 기본 컴포넌트 먼저 로드 -->
    <script src="js/ui/LoadingScreen.js?v=0.9.16"></script>
    <script src="js/ui/VolumeControl.js?v=0.9.16"></script>
    <script src="js/ui/CardRenderer.js?v=0.9.16"></script>
    <script src="js/ui/DOMCardRenderer.js?v=0.9.16"></script>
    <script src="js/ui/Renderer.js?v=0.9.16"></script>
    <script src="js/ui/AnimationManager.js?v=0.9.16"></script>
    <script src="js/ui/StageIndicator.js?v=0.9.16"></script>

    <!-- 모달 클래스들 -->
    <script src="js/ui/PlayerNameModal.js?v=0.9.16"></script>
    <script src="js/ui/CardSelectionModal.js?v=0.9.16"></script>
    <script src="js/ui/VictoryDefeatModal.js?v=0.9.16"></script>
    <script src="js/ui/LeaderboardModal.js?v=0.9.16"></script>

    <!-- 화면 클래스들 -->
    <script src="js/screens/MainMenu.js?v=0.9.16"></script>

    <!-- UI 관리자 (모든 UI 컴포넌트 이후) -->
    <script src="js/ui/UIManager.js?v=0.9.16"></script>

    <!-- 코어 시스템들 (UI 이후) -->
    <script src="js/core/BattleSystem.js?v=0.9.16"></script>
    <script src="js/core/CardManager.js?v=0.9.16"></script>
    <script src="js/core/GameManager.js?v=0.9.16"></script>
    <!-- CardSelection.js 제거 - CardSelectionModal.js로 대체됨 -->
    <script src="game.js?v=0.9.16"></script>
</body>
</html>